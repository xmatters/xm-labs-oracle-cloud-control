# Oracle Enterprise Manager Cloud Control
  Cloud Control is Oracle's solution for monitoring and managing enterprise clouds and traditional Oracle IT environments from a single console. An event connector can be built using the Connector Framework provided by Cloud Control to create/update events in xMatters.

  ![Oracle Cloud Control Overview](media/cc_overview.png?raw=true)

# Prerequisites

* Oracle Enterprise Manager Cloud Control
* Understanding of XML, XSD, and XSLT
* xMatters account

# Files
* [xm-sitescope-trigger.json](xm-sitescope-trigger.json) - This is the update set that will provide the customizations required.

# How it works
Incident Rules are configured from within Oracle Cloud Control to execute upon certain criteria. With the xMatters connector configured, the Incident Rules can be configured to execute a web service call to xMatters to create an Event for the associated Incident in Oracle Cloud Control.

# Installation

## Configuring the xMatters Connecter in Oracle Cloud Control
The following steps detail the process to configure the xMatters connector in Oracle Cloud Control

### Step 1: Extract Schema Files

1. In the Cloud Control UI, open the Extensibility Development Kit (EDK) by navigating to Setup > Extensibility > Development Kit.

    <kbd>
      <img src="https://github.com/matthewhenry1/xm-labs-oracle-cloud-control/blob/master/media/setup_development_kit.png" width="550" height="461">
    </kbd>

2. Note the requirements listed to use the EDK.

  ![EDK Requirements](media/edk_req.png?raw=true)

3. Download the EDK to your server by following the steps listed under Deployment.

  ![EDK Deployment](media/edk_deployment.png?raw=true)

4. Extract the schema files located in the **emMrsXsds.jar** file in the **emSDK** directory using the **jar** command.

For more information, see [Extracting Schema Files](https://docs.oracle.com/cd/E73210_01/EMCIG/GUID-FBA700A1-B2F0-4A7B-980C-E4816A21FAD4.htm#EMCIG416).

### Step 2: Deploy the Event Connector

1. Prepare the self archive directory

This requires the connector jar file and the manifest file for the connector. To prepare self-update, call the following utility to create a self update archive file:

```
edkutil prepare_update
        -manifest "manifest xml"
        -archivedir "archives directory"
        -out "output file or directory"
        [-typexml "update type xml"]
```

* **-manifest** Self update manifest file that describes the update.

* **-archivedir** Directory containing the archive files specified in the manifest file.

* **-out** Directory or filename for the self update archive. If a directory is specified, the filename is autogenerated.

* **-typexml** Optional path to the update type xml

The following example creates a self update archive in the `/u01/sar` directory based on the manifest file `/u01/connector/connector_manifest.xml`. The archives referred to in `connector_manifest.xml` are picked from the directory `/u01/connector/archives`.

Command:
`edkutil prepare_update -manifest /u01/connector/connector_manifest.xml -archivedir /u01/connector/archives -out  /u01/sar/xmatters_connector.zip`

Another example:
```
/u02/gc_inst/em/EMGC_OMS1/sysman/oracle_edk/bin/edkutil prepare_update -manifest "connector_manifest.xml" \
-archivedir "/u02/gc_inst/em/EMGC_OMS1/sysman/xMatterMgMtCollector" \
-out "/u02/gc_inst/em/EMGC_OMS1/sysman/xMatterMgMtCollector"
```

Example output:
```
[oracle@b12cloudcp1 xMatterMgMtCollector]$ /u02/gc_inst/em/EMGC_OMS1/sysman/oracle_edk/bin/edkutil prepare_update -manifest "connector_manifest.xml" \
> -archivedir "/u02/gc_inst/em/EMGC_OMS1/sysman/xMatterMgMtCollector" \
> -out "/u02/gc_inst/em/EMGC_OMS1/sysman/xMatterMgMtCollector"
Archive created successfully: /u02/gc_inst/em/EMGC_OMS1/sysman/xMatterMgMtCollector/FCD7F48FED8DBA5CF7E0FA63D3601B91.zip
```

2. Import the connector to Cloud Control
   - command: `emcli import_update -file=\/u01/common/update1.zip\ -omslocal`
Example:
`emcli import_update -file=\/u02/gc_inst/em/EMGC_OMS1/sysman/xMatterMgMtCollector/FCD7F48FED8DBA5CF7E0FA63D3601B91.zip -omslocal`

Example Output:
```
Processing update: Management Connector -  xMatters Connector 12.1.0.1.0
Successfully uploaded the update to Enterprise Manager. Use the Self Update Console to manage this update.
```

3. Query the connector
   - command: `emcli list -resource=Updates -bind="et_name = 'core_connector'"`

Example output:

Notice that the xMatters Connector is only downloaded

`[oracle@b12cloudcp1 xMatterMgMtCollector]$ emcli list -resource=Updates -bind="et_name = 'core_connector'"`

```
Status      Category              Type                  Version               Vendor      Size (MB)   Id
Downloaded  Ticketing Connector   CASD No Publish Conn  12.1.0.2.0            Oracle      27.892      F8EF550F79F0CD897A3389A3F70DBBDD
                                  ector
Downloaded  Ticketing Connector   HP Service Manager 7  12.1.0.2.0            Oracle      0.010       DD4E9161C5E7129F9641447FB4F0497B
                                  .1 Connector
Downloaded  Ticketing Connector   HP Service Manager 9  12.1.0.1.0            Oracle      0.009       1824FE6EEA4EBF4376F2106258424116
                                   Connector
Downloaded  Event Connector       SCOM 2012 Connector   12.1.0.1.0            Oracle      26.764      67FE5391D62F216C3BEFD1AFE7113017
Downloaded  Ticketing Connector   CASD Connector        12.1.0.3.0            Oracle      26.092      ECBD57D1D9D4D2B9AE0B9AAB65F6051F
Downloaded  Event Connector       HP OMU Connector      12.1.0.3.0            Oracle      34.998      D8DAF8ECCF7184565042563BAE7E8D4C
Downloaded  Event Connector       IBM Tivoli Netcool/O  12.1.0.3.0            Oracle      27.554      5D901DB96F7586A0CB6EBA83F6F4F569
                                  MNIbus Connector
Downloaded  Ticketing Connector   Remedy Service Desk   12.1.0.3.0            Oracle      0.216       A9F2E27B5B6DA9358F2E899AB731BBDD
                                  7.6 Connector
Downloaded  Event Connector       SCOM preR2 Connector  12.1.0.3.0            Oracle      25.737      BD97BD3A2EBE645065E7627017D0BA6F
Downloaded  Event Connector       SCOM R2 Connector     12.1.0.3.0            Oracle      25.737      C80CD503F29150BC8D51776543889227
Downloaded  Ticketing Connector   ServiceNow Connector  12.1.0.1.0            Oracle      0.011       6551E1B6E9B6F1D0151B1B917B90E907
Available   Event Connector       TEC Connector         12.1.0.3.0            Oracle      27.095      DFD569CA9FB531D9EE03FF8DFDCB4E59
Available   Event Connector       TEC Connector         12.1.0.2.0            Oracle      23.946      D9E420401CF418B77FB2A35F9BCF7EA7
Available   Event Connector       SCOM R2 Connector     12.1.0.2.0            Oracle      23.639      B2938595B9BCE936BD9A920FB99C4B86
Available   Event Connector       SCOM preR2 Connector  12.1.0.2.0            Oracle      23.639      B9DCEC9E2102A50A4948791767277196
Available   Ticketing Connector   Remedy Service Desk   12.1.0.2.0            Oracle      0.216       6BB75C3CE08E6D0A0F93D440479C7145
                                  7.6 Connector
Available   ChangeManagementConn  Remedy Change Manage  12.1.0.1.0            Oracle      0.200       5871605E67E21F8C61B8C5031F964377
            ector                 ment Connector
Available   Event Connector       IBM Tivoli Netcool/O  12.1.0.2.0            Oracle      27.384      030D4AAFEB0ED5088147B836BC8F0277
                                  MNIbus Connector
Available   Ticketing Connector   HP Service Manager 7  12.1.0.2.0            Oracle      0.010       C5289206C5A5A84AF82C49821C8F2931
                                  .0 Connector
Available   Event Connector       HP OMU Connector      12.1.0.2.0            Oracle      31.832      79D743673CA20D65720EFFBB9BE91A9C
Available   Ticketing Connector   CASD Connector        12.1.0.2.0            Oracle      27.895      04C466202A167B6DC254D203BAC1ED2E
Downloaded  Event Connector       xMatters Connector    12.1.0.1.0            Oracle      0.002       FCD7F48FED8DBA5CF7E0FA63D3601B91
Rows:22
```

4. Apply the connector

- use the connector ID for the imported connector to run the following command
- command: `emcli apply_updates -id=<ID>`

Example:

`emcli apply_update -id=FCD7F48FED8DBA5CF7E0FA63D3601B91`

Output example:
```
emcli apply_update -id=FCD7F48FED8DBA5CF7E0FA63D3601B91
A job has been submitted to Apply the update.
The job execution id is 665E3513EA83C730E05351E670A52C7C.
For latest update status, you can execute emcli get_update_status -id="FCD7F48FED8DBA5CF7E0FA63D3601B91"
[oracle@b12cloudcp1 xMatterMgMtCollector]$ emcli get_update_status -id="FCD7F48FED8DBA5CF7E0FA63D3601B91"
Update status is Applied.
```

5. Rerun query to confirm status:

`emcli list -resource=Updates -bind="et_name = 'core_connector'"`

Example Output:

Notice you will find that the xMatters Connector is now applied
```
Status      Category              Type                  Version               Vendor      Size (MB)   Id
Downloaded  Ticketing Connector   CASD No Publish Conn  12.1.0.2.0            Oracle      27.892      F8EF550F79F0CD897A3389A3F70DBBDD
                                  ector
Downloaded  Ticketing Connector   HP Service Manager 7  12.1.0.2.0            Oracle      0.010       DD4E9161C5E7129F9641447FB4F0497B
                                  .1 Connector
Downloaded  Ticketing Connector   HP Service Manager 9  12.1.0.1.0            Oracle      0.009       1824FE6EEA4EBF4376F2106258424116
                                   Connector
Downloaded  Event Connector       SCOM 2012 Connector   12.1.0.1.0            Oracle      26.764      67FE5391D62F216C3BEFD1AFE7113017
Downloaded  Ticketing Connector   CASD Connector        12.1.0.3.0            Oracle      26.092      ECBD57D1D9D4D2B9AE0B9AAB65F6051F
Downloaded  Event Connector       HP OMU Connector      12.1.0.3.0            Oracle      34.998      D8DAF8ECCF7184565042563BAE7E8D4C
Downloaded  Event Connector       IBM Tivoli Netcool/O  12.1.0.3.0            Oracle      27.554      5D901DB96F7586A0CB6EBA83F6F4F569
                                  MNIbus Connector
Downloaded  Ticketing Connector   Remedy Service Desk   12.1.0.3.0            Oracle      0.216       A9F2E27B5B6DA9358F2E899AB731BBDD
                                  7.6 Connector
Downloaded  Event Connector       SCOM preR2 Connector  12.1.0.3.0            Oracle      25.737      BD97BD3A2EBE645065E7627017D0BA6F
Downloaded  Event Connector       SCOM R2 Connector     12.1.0.3.0            Oracle      25.737      C80CD503F29150BC8D51776543889227
Downloaded  Ticketing Connector   ServiceNow Connector  12.1.0.1.0            Oracle      0.011       6551E1B6E9B6F1D0151B1B917B90E907
Available   Event Connector       TEC Connector         12.1.0.3.0            Oracle      27.095      DFD569CA9FB531D9EE03FF8DFDCB4E59
Available   Event Connector       TEC Connector         12.1.0.2.0            Oracle      23.946      D9E420401CF418B77FB2A35F9BCF7EA7
Available   Event Connector       SCOM R2 Connector     12.1.0.2.0            Oracle      23.639      B2938595B9BCE936BD9A920FB99C4B86
Available   Event Connector       SCOM preR2 Connector  12.1.0.2.0            Oracle      23.639      B9DCEC9E2102A50A4948791767277196
Available   Ticketing Connector   Remedy Service Desk   12.1.0.2.0            Oracle      0.216       6BB75C3CE08E6D0A0F93D440479C7145
                                  7.6 Connector
Available   ChangeManagementConn  Remedy Change Manage  12.1.0.1.0            Oracle      0.200       5871605E67E21F8C61B8C5031F964377
            ector                 ment Connector
Available   Event Connector       IBM Tivoli Netcool/O  12.1.0.2.0            Oracle      27.384      030D4AAFEB0ED5088147B836BC8F0277
                                  MNIbus Connector
Available   Ticketing Connector   HP Service Manager 7  12.1.0.2.0            Oracle      0.010       C5289206C5A5A84AF82C49821C8F2931
                                  .0 Connector
Available   Event Connector       HP OMU Connector      12.1.0.2.0            Oracle      31.832      79D743673CA20D65720EFFBB9BE91A9C
Available   Ticketing Connector   CASD Connector        12.1.0.2.0            Oracle      27.895      04C466202A167B6DC254D203BAC1ED2E
Applied     Event Connector       xMatters Connector    12.1.0.1.0            Oracle      0.002       FCD7F48FED8DBA5CF7E0FA63D3601B91
Rows:22
```

### Step 3: Configure the Connector
3. Configure the emedk tool by following the instructions from EDK in the Cloud Control UI (Setup > Extensibility > Development Kit)
   - note: the endpoints to be configured will be the URL's for the xMatters inbound integration from your xMatters application
   - ![Configure Name](media/configure_name.png?raw=true)
   - ![Configure Screen](media/configure_screen.png?raw=true)
   - ![Configure Endpoints](media/configure_endpoints.png?raw=true)


### If edits are required


1. Prepare the manifest file: connector_manifest.xml


For more information, see [Packaging and Deploying the Event Connector](https://docs.oracle.com/cd/E73210_01/EMCIG/GUID-FBA700A1-B2F0-4A7B-980C-E4816A21FAD4.htm#EMCIG209).
 ---

 1. Create the following template files:
    - createEvent_request_xMatters.xsl
    - createEvent_response_xMatters.xsl
    - updateEvent_request_xMatters.xsl
    - updateEvent_response_xMatters.xsl

    For more information, see [Developing Required Template Files](https://docs.oracle.com/cd/E73210_01/EMCIG/GUID-FBA700A1-B2F0-4A7B-980C-E4816A21FAD4.htm#EMCIG178).

 2. Create the connector descriptor file:
    - connectorDeploy.xml

    For more information, see [Defining the Connector Descriptor File](https://docs.oracle.com/cd/E73210_01/EMCIG/GUID-FBA700A1-B2F0-4A7B-980C-E4816A21FAD4.htm#EMCIG190).

 ### Step 3: Deploy the Event Connector

 1. Compress the connector descriptor and template files from Step 2 into a .jar file named xmatters_connector.jar

IF ANY CHANGES are needed see https://docs.oracle.com/javase/tutorial/deployment/jar/build.html regarding compressing the JAR file

Compress:

jar cf jar-file input-file(s)

jar cf xmatters_connector.jar connectorDeploy.xml createEvent_request_xmatters.xsl createEvent_response_xmatters.xsl updateEvent_request_xmatters.xsl updateEvent_response_xMatters.xsl

Extract:

jar xf jar-file

jar xf xmatters_connector.jar

## Configuring the Incident Rules to execute the xMatters Connector web service


??????

## xMatters
The following steps are to be performed in xMatters

### Communication Plan
Import the communication plan [Cloud Control Communication Plan](cloud-control-plan.zip)

### Integration Builder
From within the Integration Builder review the

# Testing
For testing execute the action to occur.

# Troubleshooting
For testing execute the action to occur.

Information regarding the configuration of this integration can be found on Oracle's [site](https://docs.oracle.com/cd/E73210_01/EMCIG/toc.htm).

1. Add xMatters root certificate to Cloud Control

cp /u02/gc_inst/em/EMGC_OMS1/sysman/config/b64LocalCertificate.txt /u02/gc_inst/em/EMGC_OMS1/sysman/config/b64LocalCertificate.txt.03012018
